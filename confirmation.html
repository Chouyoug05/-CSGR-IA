<!DOCTYPE html>
<html lang="fr">
<head>
  <title>Confirmation d'inscription - CSGR-IA</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" href="images/csgr-ia-logo.png">
  <link rel="apple-touch-icon" href="images/csgr-ia-logo.png">
  <link rel="stylesheet" href="vendors/mdi/css/materialdesignicons.min.css">
  <link rel="stylesheet" href="css/style.min.css">
  <link rel="stylesheet" href="css/csgr-custom.css">
</head>
<body class="confirmation-page">
  <header id="header-section">
    <nav class="navbar navbar-expand-lg pl-3 pl-sm-0" id="navbar">
      <div class="container">
        <div class="navbar-brand-wrapper d-flex w-100">
          <a href="index.html"><img src="images/csgr-ia-logo.png" alt="CSGR-IA Logo"></a>
        </div>
      </div> 
    </nav>   
  </header>

  <div class="content-wrapper">
    <div class="container py-5">
      <a href="index.html" class="btn btn-outline-secondary mb-4">
        <i class="mdi mdi-arrow-left mr-2"></i>Retour à l'accueil
      </a>
      <div class="row align-items-center">
        <!-- Image à gauche -->
        <div class="col-12 col-lg-5 mb-4 mb-lg-0">
          <div class="text-center">
            <img src="images/Group2.svg" alt="Confirmation CSGR-IA" class="img-fluid" style="max-height: 500px;">
          </div>
        </div>
        
        <!-- Contenu de confirmation à droite -->
        <div class="col-12 col-lg-7">
          <div class="text-center mb-4">
            <div class="mb-3">
              <i class="mdi mdi-check-circle" style="font-size: 100px; color: #28a745;"></i>
            </div>
            <h1 class="mb-3">Inscription confirmée !</h1>
            <p class="lead text-muted">Votre demande a été enregistrée avec succès</p>
          </div>
          
          <div id="confirmation-details" class="card border-0 shadow-lg mb-4">
            <div class="card-body p-4">
              <p class="text-muted text-center">Chargement...</p>
            </div>
          </div>
          
          <div class="text-center">
            <a href="index.html?inscrit=1" class="btn btn-primary btn-lg">
              <i class="mdi mdi-home mr-2"></i>Retour à l'accueil
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer class="border-top">
    <p class="text-center text-muted pt-4">Copyright © 2025 <strong>CSGR-IA</strong>. Tous droits réservés.</p>
  </footer>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  
  <script src="vendors/jquery/jquery.min.js"></script>
  <script src="vendors/bootstrap/bootstrap.min.js"></script>
  <script src="js/firebase-config.js"></script>
  <script src="js/csgr-firebase.js"></script>
  <script src="js/csgr-data.js"></script>
  <script>
    $(document).ready(async function() {
      try {
        const urlParams = new URLSearchParams(window.location.search);
        const inscriptionId = urlParams.get('id');
        
        if (!inscriptionId) {
          $('#confirmation-details').html('<div class="alert alert-danger">Aucune inscription spécifiée.</div>');
          return;
        }
        
        // Récupérer directement l'inscription par ID (plus rapide que de charger toutes les inscriptions)
        const inscription = await CSGRData.getInscription(inscriptionId);
        
        if (inscription) {
          await displayConfirmation(inscription);
        } else {
          $('#confirmation-details').html('<div class="alert alert-danger">Inscription non trouvée.</div>');
        }
      } catch (error) {
        console.error('❌ Erreur lors du chargement de la confirmation:', error);
        $('#confirmation-details').html('<div class="alert alert-danger">Erreur lors du chargement des détails. Veuillez réessayer.</div>');
      }
    });

    async function displayConfirmation(inscription) {
      const programme = inscription.programmeId ? await CSGRData.getProgramme(inscription.programmeId) : null;
      const statutText = {
        'en_attente': 'En attente',
        'valide': 'Validé',
        'echoue': 'Échoué',
        'rembourse': 'Remboursé'
      };
      
      const html = `
        <h5>Merci ${inscription.prenom} ${inscription.nom} !</h5>
        <p class="mb-3">Votre inscription a été enregistrée avec succès.</p>
        <hr>
        <div class="text-left">
          <p><strong>Programme:</strong> ${programme ? programme.nom : inscription.programmeNom || 'N/A'}</p>
          <p><strong>Email:</strong> ${inscription.email}</p>
          <p><strong>Téléphone:</strong> ${inscription.telephone}</p>
          <p><strong>Statut du paiement:</strong> <span class="badge badge-${inscription.statutPaiement === 'valide' ? 'success' : 'warning'}">${statutText[inscription.statutPaiement] || inscription.statutPaiement}</span></p>
          <p><strong>Date d'inscription:</strong> ${formatDate(inscription.dateInscription)}</p>
        </div>
        <div class="alert alert-info mt-3">
          <i class="mdi mdi-information"></i> Vous recevrez un email de confirmation avec tous les détails de votre inscription.
        </div>
      `;
      $('#confirmation-details .card-body').html(html);
    }

    function formatDate(dateValue) {
      if (!dateValue) return 'N/A';
      
      let date;
      
      // Si c'est un Timestamp Firebase
      if (dateValue && typeof dateValue.toDate === 'function') {
        date = dateValue.toDate();
      } else if (dateValue && dateValue.seconds) {
        date = new Date(dateValue.seconds * 1000);
      } else if (dateValue instanceof Date) {
        date = dateValue;
      } else {
        date = new Date(dateValue);
      }
      
      if (isNaN(date.getTime())) return 'N/A';
      
      return date.toLocaleDateString('fr-FR', { day: 'numeric', month: 'long', year: 'numeric', hour: '2-digit', minute: '2-digit' });
    }
  </script>
</body>
</html>

